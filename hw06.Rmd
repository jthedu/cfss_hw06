---
title: "HW06: Income Data"
author: "Julia Du"
date: "2/18/2021"
output: 
  github_document:
    toc: true
---

```{r setup, echo=FALSE}
#knitr::opts_chunk$set(echo = TRUE)

```

## Load necessary libraries

```{r, echo = FALSE}
library(reprex)
library(tidyverse)
library(glue)
library(knitr)

theme_set(theme_minimal())
```

# Get the Data
I used Tidy Tuesday's [02/09/2021 challenge data](https://github.com/rfordatascience/tidytuesday/tree/master/data/2021/2021-02-09). This particular challenge comes from the Urban Institute and looks at racial wealth inequality over time.

*income_time*

```{r, message = FALSE, warning = FALSE}
student_debt <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/student_debt.csv')
retirement <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/retirement.csv')
home_owner <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/home_owner.csv')
#race_wealth <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/race_wealth.csv')
income_aggregate <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_aggregate.csv')
income_mean <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-09/income_mean.csv')

```

The data provided here has been normalized to 2016 dollars in some datasets and to 2019 dollars in others. For consistency's sake, I will normalize all dollar amounts to 2019 dollars, using [inflation rate info](https://www.calculator.net/inflation-calculator.html?cstartingamount1=1&cinyear1=2016&coutyear1=2019&calctype=1&x=83&y=13) based off average annual CPI data in the U.S. from 1914 to 2020.

Currently, student_debt.csv (loan_debt), retirement.csv (retirement), and race_wealth.csv (wealth_family) are in 2016 dollars. 

income_mean.csv (income_dollars) is in 2019 dollars.


```{r normalize}
# only keeping values normalized to 2019 & renaming middle quintile to "Third" for future df joining 
income_mean <- income_mean %>%
  filter(dollar_type == "2019 Dollars") %>%
  mutate(income_quintile = if_else(income_quintile == "Middle", "Third", income_quintile))

# purchasing power rates
start_2016 <- 1.05940

normalize <- function(df, column) {
  df %>%
    mutate(normalized = {{column}} * start_2016)
    #    mutate(glue_data("norm_{column}") := {{column}} * start_2016) 
    #  rename(glue('normalized_{{column}}') = {{normalized}})
  # per tidyverse rules, have to use {{}} to indicate I'm choosing a column 
  # https://dplyr.tidyverse.org/articles/programming.html 
}

student_debt <- normalize(df = student_debt, column = loan_debt)

retirement <- normalize(retirement, retirement)

# possible to write func to overwrite original df?
# possible to write func so that normalized column name is "normalized_column"
```

```{r}
# visualizing aggregate income
# recall: each income quintile has the same # of ppl in it

#reordering inc quint levels
income_leveled <- c("Lowest", "Fourth", "Third", "Second", "Highest", "Top 5%")

income_aggregate <- income_aggregate %>%
  mutate(income_quintile = factor(income_quintile, levels = income_leveled)) 

income_mean <- income_mean %>%
  mutate(income_quintile = factor(income_quintile, levels = income_leveled))

# compare # of households to income_share
income_aggregate %>%
  filter(race == "All Races") %>%
  ggplot(mapping = aes(x = number, y = income_share, color = income_quintile, group = income_quintile)) +
  geom_line()

income_aggregate %>%
  filter(race == "All Races") %>%
  ggplot(mapping = aes(x = year, y = income_share, color = income_quintile, group = income_quintile)) +
  geom_line()

income_aggregate %>%
 # filter(year == "2019") %>%
  inner_join(income_mean, by = c("year", "race", "income_quintile")) %>% 
  ggplot(mapping = aes(x = income_quintile, y = income_share, fill = income_quintile)) +
  geom_violin() +
  facet_wrap(race ~ .)
# so historically, highest income_quintile has had greatest share of income


```

```{r}
home_owner %>% 
  inner_join(student_debt, by = c("year", "race")) %>%
  ggplot(mapping = aes(x = home_owner_pct, y = loan_debt_pct, fill = race)) +
  #geom_line()
  geom_boxplot()


home_owner %>% 
  inner_join(student_debt, by = c("year", "race")) %>%
  ggplot(mapping = aes(x = home_owner_pct, y = loan_debt_pct, color = race)) +
  #geom_line()
  geom_point() +
  geom_smooth()

#home ownership over the yrs
home_owner %>%
  group_by(year, race) %>%
  ggplot(mapping = aes(x = year, y = home_owner_pct, color = race)) +
#  geom_col(position = position_dodge2(width = 0.9, preserve = "single"))
  geom_line()
```



```{r}
# comparing mean income of median quintile of racial groups over the yrs

income_mean %>%
  filter(
    dollar_type == "2019 Dollars", #already did this earlier in set-up
    income_quintile == "Middle",
    !race %in% c("Asian Alone or in Combination", "Black Alone or in Combination", "White Alone")
    ) %>%
    group_by(year, race) %>%
  ggplot(mapping = aes(x = year, y = income_dollars, color = race)) +
  #geom_line() +
  geom_point(alpha = .3) + 
  geom_smooth(method = lm, se = FALSE) +
  scale_color_viridis_d(option = "plasma", end = .7)
```



```{r}

```